<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Smart Energy Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <style>
    :root {
      --bg-light: #ffffff;
      --bg-dark: #121212;
      --text-light: #000000;
      --text-dark: #ffffff;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: 0.3s;
    }

    body.dark {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }

    .container {
      padding: 20px;
      text-align: center;
    }

    .toggle-dark {
      position: absolute;
      top: 15px;
      right: 20px;
    }

    .gauge {
      display: inline-block;
      margin: 15px;
    }

    .gauge svg {
      transform: rotate(-90deg);
      width: 120px;
      height: 120px;
    }

    .gauge circle.bg {
      stroke: #ccc;
    }

    .gauge circle.fg {
      stroke: #4caf50;
      stroke-linecap: round;
      transition: stroke-dasharray 0.3s ease;
    }

    .gauge .label {
      position: relative;
      top: -90px;
      font-weight: bold;
      font-size: 18px;
    }

    @media (max-width: 600px) {
      .gauge svg {
        width: 80px;
        height: 80px;
      }
      .gauge .label {
        font-size: 14px;
        top: -65px;
      }
    }
  </style>
</head>
<body>
  <button class="toggle-dark" onclick="toggleDarkMode()">ðŸŒ“ Toggle Dark Mode</button>
  <div class="container">
    <h2>ðŸ”Œ Live Smart Energy Dashboard</h2>
    <div id="gauges"></div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "dq08PQL2JHCpD13e9295WjatZXFnQOZLCH7Ez4aO",
      authDomain: "esp-983b0.firebaseapp.com",
      databaseURL: "https://esp-983b0-default-rtdb.firebaseio.com/",
      projectId: "esp-983b0",
      storageBucket: "esp-983b0.appspot.com",
      messagingSenderId: "YOUR_ID",
      appId: "YOUR_ID"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const paths = [
      "Home1", "Home2", "Home3", "Home4", "Home5", "Home6",
      "Home7", "Home8", "Home9", "Home10", "Home33",
      "3PhaseData", "3PhaseData1", "3PhaseData5",
      "ModbusData", "adnan", "compressor", "energyLogs",
      "energy_data", "productivityLogs", "smart_home",
      "smart_home1", "smart_home2", "smart_home3", "testData"
    ];

    const gaugeMax = {
      voltage: 300,
      current: 100,
      power: 5000
    };

    function createGauge(label, value, max) {
      const percent = Math.min(value / max, 1);
      const radius = 50;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference * (1 - percent);

      return `
        <div class="gauge">
          <svg>
            <circle class="bg" cx="60" cy="60" r="${radius}" stroke-width="10" fill="none"/>
            <circle class="fg" cx="60" cy="60" r="${radius}" stroke-width="10" fill="none"
                    stroke-dasharray="${circumference}"
                    stroke-dashoffset="${offset}"/>
          </svg>
          <div class="label">${label}<br><span>${value}</span></div>
        </div>
      `;
    }

    function updateDashboard(snapshot) {
      const data = snapshot.val();
      const container = document.getElementById('gauges');
      container.innerHTML = '';

      if (data) {
        for (let [key, value] of Object.entries(data)) {
          if (typeof value === 'object') {
            for (let [k, v] of Object.entries(value)) {
              if (!isNaN(v)) {
                let type = k.toLowerCase().includes('volt') ? 'voltage' :
                           k.toLowerCase().includes('curr') ? 'current' :
                           k.toLowerCase().includes('pow') ? 'power' : null;
                if (type) {
                  container.innerHTML += createGauge(`${key}`, parseFloat(v), gaugeMax[type]);
                }
              }
            }
          }
        }
      } else {
        container.innerHTML = '<p>No live data found.</p>';
      }
    }

    // Listen for updates from all paths
    paths.forEach(path => {
      db.ref(path).on("value", updateDashboard);
    });

    // Dark Mode
    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }
  </script>
</body>
</html>
