<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Energy Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      background: #f4f4f4;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .path {
      font-weight: bold;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    .timestamp {
      font-size: 0.9rem;
      color: gray;
      margin-bottom: 0.5rem;
    }
    .value {
      margin: 0.2rem 0;
    }
  </style>
</head>
<body>
  <h2>üîå Smart Energy Dashboard</h2>
  <div id="cardsContainer"></div>

  <script type="module">
    // ‚úÖ Firebase config (replace with your own)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://esp-983b0-default-rtdb.firebaseio.com/" // ‚úÖ your database URL
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // üîÅ Watch all paths under root
    const rootRef = ref(db, '/');
    onValue(rootRef, (snapshot) => {
      const allData = snapshot.val();
      document.getElementById("cardsContainer").innerHTML = ""; // clear UI before update
      for (const path in allData) {
        createCard(path, allData[path]);
      }
    });

    // ‚úÖ UI card generator with proper timestamp handling
    function createCard(path, data, fallbackTimestamp) {
      const container = document.getElementById("cardsContainer");
      let card = document.getElementById(path);

      if (!card) {
        card = document.createElement("div");
        card.className = "card";
        card.id = path;
        container.appendChild(card);
      }

      let ts = data?.Timestamp || fallbackTimestamp || Date.now();

      if (typeof ts === "string") ts = parseInt(ts);
      if (ts < 1000000000000) ts *= 1000; // If seconds, convert to milliseconds

      const timeString = new Date(ts).toLocaleString(); // ‚è± local time

      card.innerHTML = `
        <div class="path">${path}</div>
        <div class="timestamp">‚è± ${timeString}</div>
        <div class="values">
          ${Object.entries(data || {})
            .filter(([key]) => key !== "Timestamp")
            .map(
              ([key, value]) =>
                `<div class="value"><b>${key}:</b> ${
                  isNaN(value) ? value : parseFloat(value).toFixed(2)
                }</div>`
            )
            .join("")}
        </div>
      `;
    }
  </script>
</body>
</html>
