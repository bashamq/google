<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Energy Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <script>
    const firebaseConfig = {
      databaseURL: "https://esp-983b0-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
    }
  </style>
</head>

<body class="bg-gray-900 text-white min-h-screen">
  <header class="bg-green-600 p-4 text-white text-xl font-bold text-center">Smart Energy Dashboard</header>
  <main class="p-4">
    <div id="cards" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>

    <div class="grid md:grid-cols-3 gap-6 mt-10">
      <div>
        <h2 class="text-lg font-semibold mb-2">Average Phase Voltage (Line Graph)</h2>
        <canvas id="chart1"></canvas>
      </div>
      <div>
        <h2 class="text-lg font-semibold mb-2">Average Voltage (Line Graph)</h2>
        <canvas id="chart2"></canvas>
      </div>
      <div>
        <h2 class="text-lg font-semibold mb-2">Average Current (Line Graph)</h2>
        <canvas id="chart3"></canvas>
      </div>
    </div>
  </main>

  <script>
    const db = firebase.database();
    const dataPath = "Machine_shop_main";
    const fields = [
      "AVERAGE_PHASE_VOLTAGE", "AVERAGE_VOLTAGE", "Average_current", "FREQUENCY",
      "L1_Voltage", "L2_Voltage", "L3_Voltage", "POWER_PHASE_A", "POWER_PHASE_B", "POWER_PHASE_C",
      "PowerFactorTotal", "TOTAL_POWER", "TotalKWh", "VOLTAGE_AB", "VOLTAGE_BC", "VOLTAGE_CA",
      "current_phase_1", "current_phase_2", "current_phase_3"
    ];

    const chart1 = new Chart(document.getElementById("chart1"), {
      type: 'line',
      data: { labels: [], datasets: [{ label: 'Average Phase Voltage', data: [], borderColor: 'cyan', borderWidth: 2 }] },
      options: { scales: { x: { title: { display: true, text: 'Time' } }, y: { beginAtZero: true } } }
    });

    const chart2 = new Chart(document.getElementById("chart2"), {
      type: 'line',
      data: { labels: [], datasets: [{ label: 'Average Voltage', data: [], borderColor: 'lime', borderWidth: 2 }] },
      options: { scales: { x: { title: { display: true, text: 'Time' } }, y: { beginAtZero: true } } }
    });

    const chart3 = new Chart(document.getElementById("chart3"), {
      type: 'line',
      data: { labels: [], datasets: [{ label: 'Average Current', data: [], borderColor: 'orange', borderWidth: 2 }] },
      options: { scales: { x: { title: { display: true, text: 'Time' } }, y: { beginAtZero: true } } }
    });

    function updateCharts(time, data) {
      if (chart1.data.labels.length > 20) {
        chart1.data.labels.shift();
        chart1.data.datasets[0].data.shift();
        chart2.data.labels.shift();
        chart2.data.datasets[0].data.shift();
        chart3.data.labels.shift();
        chart3.data.datasets[0].data.shift();
      }
      chart1.data.labels.push(time);
      chart1.data.datasets[0].data.push(data.AVERAGE_PHASE_VOLTAGE);
      chart2.data.labels.push(time);
      chart2.data.datasets[0].data.push(data.AVERAGE_VOLTAGE);
      chart3.data.labels.push(time);
      chart3.data.datasets[0].data.push(data.Average_current);
      chart1.update(); chart2.update(); chart3.update();
    }

    db.ref(dataPath).on("value", snapshot => {
      const data = snapshot.val();
      const time = new Date().toLocaleTimeString();

      const cardsContainer = document.getElementById("cards");
      cardsContainer.innerHTML = "";

      fields.forEach(field => {
        const value = data[field];
        const card = document.createElement("div");
        card.className = "bg-gray-800 p-4 rounded-lg shadow-md";
        card.innerHTML = `
          <h3 class="text-sm text-gray-400">${field}</h3>
          <p class="text-xl font-bold text-green-400">${value}</p>
        `;
        cardsContainer.appendChild(card);
      });

      updateCharts(time, data);
    });
  </script>
</body>

</html>
